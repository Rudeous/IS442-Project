<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"></meta>
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Visualised Data</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link th:rel="stylesheet" th:href="@{/webjars/bootstrap/4.0.0-2/css/bootstrap.min.css} "/>
    <script th:src="@{/webjars/jquery/3.0.0/jquery.min.js}"></script>
    <script th:src="@{/webjars/popper.js/1.12.9-1/umd/popper.min.js}"></script>
    <script th:src="@{/webjars/bootstrap/4.0.0-2/js/bootstrap.min.js}"></script>
    <script th:src="@{/js/sb-admin-2.min.js}"></script>

    <link th:href="@{/css/all.min.css}" th:rel="stylesheet">
    <link th:href="@{/css/sb-admin-2.min.css}" th:rel="stylesheet">
    <style>
            .card-body{
                height: 100vh;
            }
        </style>
</head>

<body id="page-top">

<!-- Page Wrapper -->
<div id="wrapper">

    <!-- Sidebar -->
    <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

        <!-- Sidebar - Brand -->
        <a class="sidebar-brand d-flex align-items-center justify-content-center" href="india.html" >
            <img src="img/logo.png" width="120" >
        </a>

        <!-- Divider -->
        <hr class="sidebar-divider">

        <!-- Heading -->
        <div class="sidebar-heading">
            Countries
        </div>

        <!-- Nav Item - India1 -->
        <li class="nav-item">
            <a class="nav-link" href="india.html">
                <i class="fas fa-fw fa-chart-area"></i>
                <span>India 1</span></a>
        </li>

        <!-- Nav Item - Indonesia -->
        <li class="nav-item">
            <a class="nav-link" href="indonesia.html">
                <i class="fas fa-fw fa-chart-area"></i>
                <span>Indonesia</span></a>
        </li>

        <!-- Divider -->
        <hr class="sidebar-divider">

    </ul>
    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content">

            <!-- Begin Page Content -->
            <div class="container-fluid">

                <!-- Page Heading -->
                <div class="d-sm-flex align-items-center justify-content-between mb-4">
                    <h1 class="h1 mb-0 text-gray-800 mt-1">Visualised Data</h1>
                </div>


                <!-- Content Row -->

                <div class="row">

                    <!-- Area Chart -->
                    <div class="col-12">
                        <div class="card shadow mb-10 mh-100">
                            <!-- Card Header - Dropdown -->
                            <div
                                    class="card-header py-10 d-flex flex-row align-items-center justify-content-between">
                                <h6 class="m-0 font-weight-bold text-primary">India 1</h6>
                            </div>
                            <!-- Card Body -->
                            <div class="card-body">
                                <div class="chart-area">
                                    <div>
                                        <label for="years">Choose a year:</label>

                                        <select name="years" id="years" th:onchange="changeChart()">
                                            <option th:value="-1" th:selected="-1">--- Select ---</option>
                                            <option th:value="1">17-18</option>
                                            <option th:value="2">18-19</option>
                                            <option th:value="0">19-20</option>
                                            <option th:value="4">20-21</option>
                                            <option th:value="3">Current</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label for="importexport">Import/Export:</label>

                                        <select name="importexport" id="importexport" th:onchange="changeChart()">
                                            <option th:value="-1" th:selected="-1">--- Select ---</option>
                                            <option th:value="import">Import</option>
                                            <option th:value="export">Export</option>
                                            <option th:value="netimport">Net Import</option>
                                        </select>
                                    </div>

                                    <canvas id="myChart" width="200" height="100"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

        </div>
        <!-- /.container-fluid -->

    </div>
    <!-- End of Main Content -->

</div>
<!-- End of Content Wrapper -->

</div>
<!-- End of Page Wrapper -->

</body>

<script th:inline="javascript">
        var ctx = document.getElementById('myChart').getContext('2d');

        var sheetNamesArr = [];
        var monthsArr = [];
        var productNamesArr = {
            "import": [],
            "export": []
        };
        var productValuesArr = {
            "import": [],
            "export": []
        };
        var netImportArr = [];

        /*<![CDATA[*/
            var data = /*[[${data}]]*/ 'default';
        /*]]>*/

        for (var sheet in data) {
            sheetNamesArr.push(sheet);
            var labels = {
                "import": [],
                "export": [],
            };
            var values = {
                "import": [],
                "export": []
            };

            monthsArr = data[sheet]["Periods"];
            importArr = data[sheet]["Imports"];
            exportArr = data[sheet]["Exports"];

            for (var index in importArr) {
                productArr = importArr[index];

                productName = Object.keys(productArr)[0];
                labels["import"].push(productName);

                valuesArr = Object.values(productArr)[0];
                values["import"].push(valuesArr);
            }

            for (var index in exportArr) {
                productArr = exportArr[index];

                productName = Object.keys(productArr)[0];
                labels["export"].push(productName);

                valuesArr = Object.values(productArr)[0];
                values["export"].push(valuesArr);
            }

            productNamesArr["import"].push(labels["import"]);
            productNamesArr["export"].push(labels["export"]);

            productValuesArr["import"].push(values["import"]);
            productValuesArr["export"].push(values["export"]);

            console.log(data[sheet]["Net Import"]);
            netImportArr.push(data[sheet]["Net Import"]);

        }

        console.log(sheetNamesArr);
        console.log(productNamesArr);
        console.log(productValuesArr);
        console.log(netImportArr);


        var myChart = "";

        function changeChart() {

            <!-- previous chart destroyed to make way for the new chosen chart -->
            if (myChart != "") {
                myChart.destroy();
            }

            <!-- retrieve the user input for the select dropdown -->
            var yearChoice = document.getElementById("years").value;
            var importexportChoice = document.getElementById("importexport").value;
            console.log(yearChoice);
            console.log(importexportChoice);

            if (yearChoice == -1 || importexportChoice == -1) {
                return;
            }

            var chartTitle = sheetNamesArr[yearChoice].slice(-7);
            if (chartTitle.slice(4, 5) != "-") {
                chartTitle = "Current Year";
            }


            var dataSets = [];

            if (importexportChoice == "netimport") {

                dataSets.push(
                    {
                        label: "Net Import",
                        data: netImportArr[yearChoice],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(54, 247, 161, 0.2)',
                            'rgba(255, 115, 255, 0.2)',
                            'rgba(250, 137, 115, 0.2)',
                            'rgba(252, 168, 88, 0.2)',
                            'rgba(255, 117, 117, 0.2)',
                            'rgba(127, 227, 250, 0.2)',
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(127, 250, 209, 0.2)',
                            'rgba(178, 141, 252, 0.2)',
                            'rgba(168, 255, 236, 0.2)',
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(54, 247, 161, 1)',
                            'rgba(255, 115, 255, 1)',
                            'rgba(250, 137, 115, 1)',
                            'rgba(252, 168, 88, 1)',
                            'rgba(255, 117, 117, 1)',
                            'rgba(127, 227, 250, 1)',
                            'rgba(255, 99, 132, 1)',
                            'rgba(127, 250, 209, 1)',
                            'rgba(178, 141, 252, 1)',
                            'rgba(168, 255, 236, 1)',
                        ],
                        borderWidth: 1
                    }
                );
            }

            else {
                for (i = 0; i < productNamesArr[importexportChoice][yearChoice].length; i++) {
                    dataSets.push(
                        {
                            label: productNamesArr[importexportChoice][yearChoice][i],
                            data: productValuesArr[importexportChoice][yearChoice][i],
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.2)',
                                'rgba(54, 162, 235, 0.2)',
                                'rgba(54, 247, 161, 0.2)',
                                'rgba(255, 115, 255, 0.2)',
                                'rgba(250, 137, 115, 0.2)',
                                'rgba(252, 168, 88, 0.2)',
                                'rgba(255, 117, 117, 0.2)',
                                'rgba(127, 227, 250, 0.2)',
                                'rgba(255, 99, 132, 0.2)',
                                'rgba(127, 250, 209, 0.2)',
                                'rgba(178, 141, 252, 0.2)',
                                'rgba(168, 255, 236, 0.2)',
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(54, 247, 161, 1)',
                                'rgba(255, 115, 255, 1)',
                                'rgba(250, 137, 115, 1)',
                                'rgba(252, 168, 88, 1)',
                                'rgba(255, 117, 117, 1)',
                                'rgba(127, 227, 250, 1)',
                                'rgba(255, 99, 132, 1)',
                                'rgba(127, 250, 209, 1)',
                                'rgba(178, 141, 252, 1)',
                                'rgba(168, 255, 236, 1)',
                            ],
                            borderWidth: 1
                        }
                    );
                }
            }


            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: monthsArr,
                    datasets: dataSets
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: chartTitle
                        }
                    }
                }
            });

        }


    </script>

</html>